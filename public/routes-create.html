<!-- TITLE: Create Route - AMS.ceo -->
<!-- SUBTITLE: Create New Route -->
<!-- SCRIPTS: /js/cargo-types.js, /js/flight-timing.js, /js/routes-create.js -->

<style>
  .btn-custom-atc {
    display: inline-flex;
    align-items: center;
    padding: 0.3rem 0.65rem;
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--text-muted, #8b949e);
    background: none;
    border: 1px solid var(--border-color, #30363d);
    border-radius: 4px;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    transition: all 0.15s;
  }
  .btn-custom-atc:hover {
    color: var(--accent-color, #58a6ff);
    border-color: var(--accent-color, #58a6ff);
    background: rgba(88, 166, 255, 0.08);
  }
  .btn-expand-map {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 22px;
    height: 22px;
    background: none;
    border: 1px solid var(--border-color, #30363d);
    border-radius: 4px;
    color: var(--text-muted, #8b949e);
    cursor: pointer;
    transition: all 0.15s;
  }
  .btn-expand-map:hover {
    color: var(--accent-color, #58a6ff);
    border-color: var(--accent-color, #58a6ff);
    background: rgba(88, 166, 255, 0.08);
  }
  .leaflet-interactive:focus {
    outline: none !important;
  }
  .fir-tooltip {
    background: rgba(22, 27, 34, 0.95) !important;
    border: 1px solid var(--border-color, #30363d) !important;
    color: var(--text-primary, #e6edf3) !important;
    font-size: 0.75rem !important;
    font-family: 'Courier New', monospace !important;
    padding: 0.3rem 0.5rem !important;
    border-radius: 4px !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4) !important;
  }
  .fir-tooltip::before {
    border-top-color: rgba(22, 27, 34, 0.95) !important;
  }
  .atc-stat-badge {
    font-size: 0.7rem;
    font-weight: 600;
    padding: 0.2rem 0.6rem;
    border-radius: 4px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }
  .atc-stat-badge.resolved {
    background: rgba(63, 185, 80, 0.1);
    color: #3fb950;
    border: 1px solid rgba(63, 185, 80, 0.3);
  }
  .atc-stat-badge.unresolved {
    background: rgba(227, 179, 65, 0.1);
    color: #e3b341;
    border: 1px solid rgba(227, 179, 65, 0.3);
  }
  .atc-stat-badge.airway {
    background: rgba(88, 166, 255, 0.1);
    color: var(--accent-color, #58a6ff);
    border: 1px solid rgba(88, 166, 255, 0.3);
  }
  .atc-waypoint-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.4rem 0.75rem;
    border-bottom: 1px solid var(--border-color, #30363d);
    font-family: 'Courier New', monospace;
  }
  .atc-waypoint-row:last-child { border-bottom: none; }
  .atc-waypoint-row .wp-name { font-weight: 700; color: var(--text-primary); }
  .atc-waypoint-row .wp-coords { font-size: 0.7rem; color: var(--text-muted); }
  .atc-waypoint-row .wp-index { font-size: 0.65rem; color: var(--text-muted); margin-right: 0.5rem; min-width: 20px; }
  .day-button:hover {
    opacity: 0.85;
  }
  .day-button:active {
    transform: scale(0.95);
  }
  /* Airport list table layout */
  .airport-row {
    display: grid;
    grid-template-columns: 1fr 52px 78px 44px 72px 54px;
    align-items: center;
    gap: 0.25rem;
    padding: 0.4rem 0.75rem;
    border-bottom: 1px solid var(--border-color);
    transition: background 0.15s;
  }
  .airport-row:hover { background: rgba(255,255,255,0.03); }
  .airport-row.selected { background: var(--accent-color-dim); }
  .airport-row .airport-select-zone {
    cursor: pointer;
    min-width: 0;
  }
  .airport-row .airport-select-zone:hover { opacity: 0.8; }
  .airport-list-header {
    display: grid;
    grid-template-columns: 1fr 52px 78px 44px 72px 54px;
    gap: 0.25rem;
    padding: 0.35rem 0.75rem;
    font-size: 0.6rem;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 1px solid var(--border-color);
    background: var(--surface-elevated);
    position: sticky;
    top: 0;
    z-index: 2;
  }
  .airport-list-header > span:not(:first-child) { text-align: center; }

  /* Indicator hover tooltips */
  .indicator-hover {
    position: relative;
    display: flex;
    justify-content: center;
  }
  .indicator-tooltip {
    display: none;
    position: absolute;
    top: calc(100% + 8px);
    right: -8px;
    background: #1a1a2e;
    border: 1px solid #333;
    border-radius: 6px;
    padding: 0.5rem 0.65rem;
    min-width: 190px;
    max-width: 230px;
    z-index: 100;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    pointer-events: none;
  }
  .indicator-tooltip::before {
    content: '';
    position: absolute;
    bottom: 100%;
    right: 16px;
    border: 5px solid transparent;
    border-bottom-color: #333;
  }
  .indicator-hover:hover .indicator-tooltip {
    display: block;
  }
  .nat-preview-label {
    background: none;
    border: none;
  }
  .nat-preview-label span {
    font-size: 0.65rem;
    font-weight: 700;
    color: #4ade80;
    text-shadow: 0 0 3px rgba(0,0,0,0.8);
    white-space: nowrap;
    font-family: 'Courier New', monospace;
    letter-spacing: 0.5px;
  }

  /* ── Cargo Demand Grid ─────────────────────────────────────────────────── */
  .cargo-demand-item {
    background: var(--surface-elevated);
    border: 1px solid var(--border-color);
    border-radius: 5px;
    padding: 0.3rem 0.45rem;
    display: flex;
    flex-direction: column;
    gap: 0.18rem;
  }
  .cargo-demand-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .cargo-demand-code {
    font-size: 0.58rem;
    font-weight: 800;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }
  .cargo-demand-value {
    font-size: 0.58rem;
    font-family: 'Courier New', monospace;
    font-weight: 600;
    color: var(--text-muted);
  }
  .cargo-demand-bar-track {
    height: 3px;
    background: var(--border-color);
    border-radius: 2px;
    overflow: hidden;
  }
  .cargo-demand-bar-fill {
    height: 100%;
    border-radius: 2px;
    transition: width 0.3s ease;
  }
</style>

<div class="dashboard-container">

  <main class="main-content">
    <div class="page-header" style="margin-bottom: 0.5rem;">
      <h1 id="routesTitle" style="margin-bottom: 0.15rem;">CREATE NEW ROUTE</h1>
      <p class="subtitle" id="stepSubtitle" style="margin: 0;">STEP 1: SELECT DESTINATION</p>
    </div>

    <!-- Step Indicator -->
    <div style="display: flex; gap: 0.5rem; margin-bottom: 0.75rem; align-items: center;">
      <div id="step1Indicator" style="flex: 1; padding: 0.4rem 0.6rem; background: var(--accent-color); border-radius: 4px; text-align: center; color: white; font-weight: 600; font-size: 0.8rem; transition: all 0.3s;">
        1. DESTINATION
      </div>
      <div style="width: 1rem; height: 2px; background: var(--border-color);"></div>
      <div id="step2Indicator" style="flex: 1; padding: 0.4rem 0.6rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; text-align: center; color: var(--text-muted); font-weight: 600; font-size: 0.8rem; transition: all 0.3s;">
        2. SCHEDULE
      </div>
      <div style="width: 1rem; height: 2px; background: var(--border-color);"></div>
      <div id="step3Indicator" style="flex: 1; padding: 0.4rem 0.6rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; text-align: center; color: var(--text-muted); font-weight: 600; font-size: 0.8rem; transition: all 0.3s;">
        3. PRICING
      </div>
    </div>

    <!-- Step 1: Destination Selection -->
    <div id="step1Container">
      <!-- Selected Destination Panel (shown when destination is selected) -->
      <div id="selectedDestinationPanelStep1" class="ops-panel full-width" style="margin-bottom: 0.75rem; display: none; border: 2px solid var(--accent-color);">
        <div class="panel-header" style="background: var(--accent-color-dim); padding: 0.5rem 0.75rem;">
          <h2 style="color: var(--accent-color); font-size: 0.85rem; margin: 0;">SELECTED DESTINATION</h2>
          <div style="display: flex; gap: 0.5rem;">
            <button onclick="clearDestinationStep1()" class="btn btn-secondary btn-sm">CHANGE</button>
            <button onclick="proceedToStep2()" class="btn btn-primary btn-sm">NEXT →</button>
          </div>
        </div>
        <div class="panel-body" style="padding: 0.75rem;">
          <!-- Row 1: Airport info -->
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
            <div>
              <h3 id="selectedDestNameStep1" style="color: var(--text-primary); margin: 0 0 0.2rem 0; font-size: 1.05rem; font-weight: 600;">--</h3>
              <p id="selectedDestDetailsStep1" style="color: var(--text-secondary); margin: 0; font-size: 0.85rem;">--</p>
            </div>
            <div id="selectedDestDistanceStep1" style="color: var(--accent-color); font-weight: 700; font-size: 1.4rem; line-height: 1; white-space: nowrap;">-- NM</div>
          </div>

          <!-- Row 2: Route stats -->
          <div id="selectedDestStats" style="display: grid; grid-template-columns: 1fr 1fr 2fr 1fr; gap: 0.5rem; margin-bottom: 0.75rem;">
            <div style="background: var(--surface-elevated); border-radius: 6px; padding: 0.5rem 0.6rem; text-align: center;">
              <div style="color: var(--text-muted); font-size: 0.65rem; text-transform: uppercase; margin-bottom: 0.2rem;">Demand</div>
              <div id="statDemand" style="font-weight: 700; font-size: 0.95rem; color: var(--text-primary);">--</div>
            </div>
            <div style="background: var(--surface-elevated); border-radius: 6px; padding: 0.5rem 0.6rem; text-align: center;">
              <div style="color: var(--text-muted); font-size: 0.65rem; text-transform: uppercase; margin-bottom: 0.2rem;">Yield</div>
              <div id="statYield" style="font-weight: 700; font-size: 0.95rem; color: var(--text-primary);">--</div>
            </div>
            <div style="background: var(--surface-elevated); border-radius: 6px; padding: 0.5rem 0.6rem; text-align: center;">
              <div style="color: var(--text-muted); font-size: 0.65rem; text-transform: uppercase; margin-bottom: 0.2rem;">Class Mix</div>
              <div id="statClassMix" style="font-weight: 700; font-size: 0.85rem; color: var(--text-primary);">--</div>
            </div>
            <div style="background: var(--surface-elevated); border-radius: 6px; padding: 0.5rem 0.6rem; text-align: center;">
              <div style="color: var(--text-muted); font-size: 0.65rem; text-transform: uppercase; margin-bottom: 0.2rem;">Competition</div>
              <div id="statCompetition" style="font-weight: 700; font-size: 0.95rem; color: var(--text-primary);">--</div>
            </div>
          </div>

          <!-- Row 3: Yield breakdown (pros/cons) -->
          <div id="selectedDestYieldBreakdown" style="margin-bottom: 0.75rem; display: none;">
            <div style="color: var(--text-muted); font-size: 0.7rem; text-transform: uppercase; font-weight: 600; margin-bottom: 0.3rem;">Yield Factors</div>
            <div id="yieldFactorsList" style="display: flex; gap: 0.5rem; flex-wrap: wrap;"></div>
          </div>

          <!-- Row 4: Cargo demand -->
          <div id="selectedDestCargoSection" style="display: none; margin-bottom: 0.75rem;">
            <div style="color: var(--text-muted); font-size: 0.7rem; text-transform: uppercase; font-weight: 600; margin-bottom: 0.4rem; letter-spacing: 0.5px;">Cargo Demand</div>
            <div id="cargoDemandGrid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.3rem;"></div>
          </div>

          <!-- Row 5: Airport movements chart -->
          <div id="selectedDestTimeChart" style="display: none; border: 1px solid var(--border-color); border-radius: 6px; overflow: hidden; margin-bottom: 0.75rem;">
            <div style="background: var(--surface-elevated); padding: 0.4rem 0.6rem; font-size: 0.7rem; text-transform: uppercase; font-weight: 600; color: var(--text-muted); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
              <span>Airport traffic by hour</span>
              <div style="display: flex; gap: 0.6rem; font-size: 0.6rem; text-transform: none; font-weight: 500;">
                <span><span style="display: inline-block; width: 8px; height: 8px; background: #f59e0b; border-radius: 2px; vertical-align: middle; margin-right: 3px;"></span>Departures</span>
                <span><span style="display: inline-block; width: 8px; height: 8px; background: #22d3ee; border-radius: 2px; vertical-align: middle; margin-right: 3px;"></span>Arrivals</span>
              </div>
            </div>
            <div style="padding: 0.5rem 0.6rem;">
              <div id="timeChartBars" style="display: flex; align-items: flex-end; gap: 1px; height: 48px;"></div>
              <div id="timeChartLabels" style="display: flex; gap: 1px; margin-top: 2px;"></div>
            </div>
          </div>

          <!-- Row 5: Competitors + Popular Origins side by side -->
          <div id="selectedDestRouteInfo" style="display: none; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
            <div id="selectedDestCompetitors" style="border: 1px solid var(--border-color); border-radius: 6px; overflow: hidden;">
              <div style="background: var(--surface-elevated); padding: 0.4rem 0.6rem; font-size: 0.7rem; text-transform: uppercase; font-weight: 600; color: var(--text-muted); border-bottom: 1px solid var(--border-color);">
                Airlines on this route <span id="competitorCount" style="color: var(--text-secondary);"></span>
              </div>
              <div id="competitorsList" style="max-height: 220px; overflow-y: auto;"></div>
            </div>
            <div id="selectedDestPopularOrigins" style="border: 1px solid var(--border-color); border-radius: 6px; overflow: hidden;">
              <div style="background: var(--surface-elevated); padding: 0.4rem 0.6rem; font-size: 0.7rem; text-transform: uppercase; font-weight: 600; color: var(--text-muted); border-bottom: 1px solid var(--border-color);">
                Other routes into this airport <span id="popularOriginsCount" style="color: var(--text-secondary);"></span>
              </div>
              <div style="display: grid; grid-template-columns: 50px 1fr 40px; gap: 0 0.4rem; padding: 0.25rem 0.6rem; font-size: 0.65rem; text-transform: uppercase; color: var(--text-muted); border-bottom: 1px solid var(--border-color); font-weight: 600;">
                <span>Origin</span><span>Airlines</span><span style="text-align: right;">Rts</span>
              </div>
              <div id="popularOriginsList" style="max-height: 180px; overflow-y: auto;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Destination Search and Selection (Combined) -->
      <div id="destinationSearchPanel" class="ops-panel full-width" style="margin-bottom: 0.75rem;">
        <div class="panel-header" style="padding: 0.5rem 0.75rem;">
          <h2 style="font-size: 0.85rem; margin: 0;">SELECT DESTINATION</h2>
          <span id="airportCountBadge" class="badge" style="background: var(--accent-color); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">-- AIRPORTS</span>
        </div>
        <div class="panel-body" style="padding: 0.75rem;">
          <!-- Search Box -->
          <div style="margin-bottom: 0.6rem;">
            <input
              type="text"
              id="searchKeyword"
              placeholder="Search by ICAO, IATA, name, or city..."
              oninput="debouncedApplyFilters()"
              style="width: 100%; padding: 0.5rem 0.6rem; background: var(--surface-elevated); border: 2px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem; transition: border-color 0.2s;"
              onfocus="this.style.borderColor='var(--accent-color)'"
              onblur="this.style.borderColor='var(--border-color)'"
            />
          </div>

          <!-- Collapsible Filters Section -->
          <details style="margin-bottom: 0.6rem;">
            <summary style="padding: 0.4rem 0.6rem; background: var(--surface); border: 1px solid var(--border-color); border-radius: 4px; cursor: pointer; color: var(--text-secondary); font-size: 0.8rem; font-weight: 600; user-select: none; transition: all 0.2s;" onmouseover="this.style.background='var(--surface-elevated)'" onmouseout="this.style.background='var(--surface)'">
              Advanced Filters
            </summary>
            <div style="margin-top: 0.6rem; padding: 0.75rem; background: var(--surface); border: 1px solid var(--border-color); border-radius: 4px;">
          <!-- Filters Grid -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.6rem; margin-bottom: 0.6rem;">
            <div>
              <label style="display: block; margin-bottom: 0.25rem; color: var(--text-secondary); font-size: 0.75rem;">Continent</label>
              <select
                id="continentFilter"
                onchange="filterAirportsByContinent()"
                style="width: 100%; padding: 0.4rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem;"
              >
                <option value="">-- All continents --</option>
                <option value="Africa">Africa</option>
                <option value="Asia">Asia</option>
                <option value="Europe">Europe</option>
                <option value="North America">North America</option>
                <option value="South America">South America</option>
                <option value="Oceania">Oceania</option>
              </select>
            </div>

            <div>
              <label style="display: block; margin-bottom: 0.25rem; color: var(--text-secondary); font-size: 0.75rem;">Country</label>
              <select
                id="countryFilter"
                onchange="applyDestinationFilters()"
                style="width: 100%; padding: 0.4rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem;"
              >
                <option value="">-- All countries --</option>
              </select>
            </div>

            <div>
              <label style="display: block; margin-bottom: 0.25rem; color: var(--text-secondary); font-size: 0.75rem;">Time zone</label>
              <select
                id="timezoneFilter"
                onchange="applyDestinationFilters()"
                style="width: 100%; padding: 0.4rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem;"
              >
                <option value="">Any</option>
              </select>
            </div>
          </div>

          <div style="margin-bottom: 0.6rem;">
            <label style="display: block; margin-bottom: 0.25rem; color: var(--text-secondary); font-size: 0.75rem;">Custom Range (NM)</label>
            <div style="display: flex; gap: 0.4rem; align-items: center;">
              <input
                type="number"
                id="minRange"
                oninput="applyDestinationFilters(); document.getElementById('haulTypeFilter').value='';"
                placeholder="min"
                min="0"
                style="flex: 1; padding: 0.4rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem;"
              />
              <span style="color: var(--text-muted); font-size: 0.8rem;">to</span>
              <input
                type="number"
                id="maxRange"
                oninput="applyDestinationFilters(); document.getElementById('haulTypeFilter').value='';"
                placeholder="max"
                min="0"
                style="flex: 1; padding: 0.4rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem;"
              />
            </div>
          </div>
            </div>
          </details>

          <!-- Results Header with Filters -->
          <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0.6rem; background: var(--surface); border-left: 3px solid var(--accent-color); margin-bottom: 0.4rem; border-radius: 0 4px 4px 0;">
            <span style="color: var(--text-secondary); font-size: 0.8rem; font-weight: 600;">AVAILABLE DESTINATIONS</span>
            <div style="display: flex; gap: 0.75rem; align-items: center;">
              <select
                id="haulTypeFilter"
                onchange="applyHaulTypeFilter()"
                style="padding: 0.3rem 0.5rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.75rem; cursor: pointer;"
              >
                <option value="">All distances</option>
                <option value="short">Short haul</option>
                <option value="medium">Medium haul</option>
                <option value="long">Long haul</option>
              </select>
              <label style="display: flex; align-items: center; gap: 0.3rem; color: var(--text-secondary); cursor: pointer;">
                <input
                  type="checkbox"
                  id="excludeExistingRoutes"
                  onchange="applyDestinationFilters()"
                  style="width: 0.85rem; height: 0.85rem; cursor: pointer;"
                />
                <span style="font-size: 0.75rem;">Hide airports I already fly to</span>
              </label>
              <select
                id="sortOrder"
                onchange="applyDestinationFilters()"
                style="padding: 0.3rem 0.5rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.75rem; cursor: pointer;"
              >
                <option value="demand">By Demand</option>
                <option value="closest">Closest</option>
                <option value="furthest">Furthest</option>
              </select>
            </div>
          </div>
          <div id="availableAirportsList" style="border: 1px solid var(--border-color); border-radius: 4px; max-height: 450px; overflow-y: auto; background: var(--surface-elevated);">
            <div style="padding: 3rem; text-align: center; color: var(--text-muted);">
              Loading airports...
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 2: Route Configuration (hidden initially) -->
    <div id="step2Container" style="display: none;">
      <!-- Back to Step 1 button -->
      <div style="margin-bottom: 1rem;">
        <button onclick="backToStep1()" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.85rem;">
          ← BACK TO DESTINATION SELECTION
        </button>
      </div>

      <!-- Route Configuration Panel -->
      <div class="ops-panel full-width" style="margin-bottom: 2rem;">
        <div class="panel-header" style="padding: 0.75rem 1rem;">
          <h2 style="font-size: 0.95rem; margin: 0;">ROUTE CONFIGURATION</h2>
        </div>
        <div class="panel-body" style="padding: 1rem;">
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem;">
            <div>
              <label style="display: block; margin-bottom: 0.35rem; color: var(--text-secondary); font-weight: 600; font-size: 0.8rem;">Route Number *</label>
              <div style="display: flex; gap: 0.25rem;">
                <input
                  type="text"
                  id="routePrefix"
                  value="--"
                  readonly
                  maxlength="2"
                  style="width: 3rem; padding: 0.5rem; background: var(--surface); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-muted); cursor: not-allowed; font-size: 0.9rem; text-align: center; font-weight: 600;"
                />
                <input
                  type="text"
                  id="routeNumber"
                  placeholder="123"
                  maxlength="7"
                  oninput="suggestReturnRouteNumber()"
                  style="flex: 1; padding: 0.5rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;"
                />
              </div>
            </div>

            <div>
              <label style="display: block; margin-bottom: 0.35rem; color: var(--text-secondary); font-weight: 600; font-size: 0.8rem;">Departure Airport</label>
              <input
                type="text"
                id="departureAirport"
                value="Loading..."
                readonly
                style="width: 100%; padding: 0.5rem; background: var(--surface); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-muted); cursor: not-allowed; font-size: 0.9rem;"
              />
            </div>

            <div>
              <label style="display: block; margin-bottom: 0.35rem; color: var(--text-secondary); font-weight: 600; font-size: 0.8rem;">Arrival Airport</label>
              <input
                type="text"
                id="arrivalAirport"
                value="--"
                readonly
                style="width: 100%; padding: 0.5rem; background: var(--surface); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-muted); cursor: not-allowed; font-size: 0.9rem;"
              />
            </div>
          </div>

          <!-- Technical Stop Option -->
          <div style="margin-top: 1rem;">
            <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-primary); cursor: pointer; font-weight: 600; font-size: 0.85rem;">
              <input
                type="checkbox"
                id="includeTechStop"
                onchange="toggleTechStopSection()"
                style="width: 1.1rem; height: 1.1rem; cursor: pointer;"
              />
              <span>Add fuelling technical stop</span>
            </label>
            <p style="margin: 0.25rem 0 0 1.6rem; color: var(--text-muted); font-size: 0.75rem;">
              Add an intermediate stop for refuelling on long routes
            </p>
          </div>

          <!-- Technical Stop Section (hidden by default) -->
          <div id="techStopSection" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px;">
            <h4 style="color: var(--text-secondary); font-size: 0.85rem; margin: 0 0 0.75rem 0; font-weight: 600;">TECHNICAL STOP AIRPORT</h4>

            <!-- Search for tech stop -->
            <div style="margin-bottom: 0.75rem;">
              <label style="display: block; margin-bottom: 0.35rem; color: var(--text-secondary); font-size: 0.75rem;">Search for technical stop airport</label>
              <input
                type="text"
                id="techStopSearch"
                placeholder="Search by ICAO, IATA, name, or city..."
                oninput="searchTechStopAirports()"
                style="width: 100%; padding: 0.5rem; background: var(--surface); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem;"
              />
            </div>

            <!-- Search results -->
            <div id="techStopResults" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 4px; margin-bottom: 0.75rem; display: none;">
              <!-- Results will be populated here -->
            </div>

            <!-- Selected tech stop display -->
            <div id="selectedTechStop" style="display: none; padding: 0.75rem; background: var(--surface); border: 1px solid var(--accent-color); border-radius: 4px;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                <div>
                  <div id="techStopName" style="font-weight: 600; color: var(--text-primary); font-size: 0.85rem; margin-bottom: 0.25rem;">--</div>
                  <div id="techStopDetails" style="color: var(--text-secondary); font-size: 0.75rem;">--</div>
                </div>
                <button onclick="clearTechStop()" style="padding: 0.25rem 0.5rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer;">Clear</button>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--border-color);">
                <div>
                  <div style="color: var(--text-muted); font-size: 0.7rem;">From Departure</div>
                  <div id="techStopDistanceFromDep" style="color: var(--accent-color); font-weight: 700; font-size: 1rem;">-- NM</div>
                </div>
                <div>
                  <div style="color: var(--text-muted); font-size: 0.7rem;">To Destination</div>
                  <div id="techStopDistanceToDest" style="color: var(--accent-color); font-weight: 700; font-size: 1rem;">-- NM</div>
                </div>
              </div>
            </div>
          </div>

        <div style="margin-bottom: 1rem;">
          <label style="display: block; margin-bottom: 0.35rem; color: var(--text-secondary); font-weight: 600; font-size: 0.8rem;">Aircraft Type *</label>
          <select
            id="assignedAircraft"
            required
            style="width: 100%; padding: 0.5rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;"
          >
            <option value="">-- Select aircraft type --</option>
          </select>
          <div id="rangeWarning" style="display:none; margin-top:0.5rem; padding:0.5rem 0.75rem; background:rgba(239,68,68,0.1); border:1px solid rgba(239,68,68,0.4); border-radius:4px; color:#ef4444; font-size:0.8rem; line-height:1.5;"></div>
        </div>

        <div>
          <label style="display: block; margin-bottom: 0.35rem; color: var(--text-secondary); font-weight: 600; font-size: 0.8rem;">Schedule Time *</label>
          <input
            type="time"
            id="departureTime"
            value="08:00"
            style="width: 100%; padding: 0.5rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;"
          />
          <p style="margin: 0.25rem 0 0 0; color: var(--text-muted); font-size: 0.7rem;">
            Time when pre-flight actions begin
          </p>
        </div>

        <!-- Days of Operation -->
        <div id="daysOfWeekSection" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
          <div style="margin-bottom: 0.75rem;">
            <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-primary); cursor: pointer; font-weight: 600; font-size: 0.85rem;">
              <input
                type="checkbox"
                id="sevenDaySchedule"
                onchange="toggleSevenDaySchedule()"
                checked
                style="width: 1.1rem; height: 1.1rem; cursor: pointer;"
              />
              <span>Daily Service</span>
            </label>
            <p style="margin: 0.25rem 0 0 1.6rem; color: var(--text-muted); font-size: 0.75rem;">
              Route operates every day of the week
            </p>
          </div>

          <div style="margin-bottom: 0.75rem;">
            <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-primary); cursor: pointer; font-weight: 600; font-size: 0.85rem;">
              <input
                type="checkbox"
                id="createSeparateDailyRoutes"
                style="width: 1.1rem; height: 1.1rem; cursor: pointer;"
              />
              <span>Create each daily service as a separate route</span>
            </label>
            <p style="margin: 0.25rem 0 0 1.6rem; color: var(--text-muted); font-size: 0.75rem;">
              Creates individual route records for each selected day
            </p>
          </div>

          <div>
            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-weight: 600; font-size: 0.8rem;">Days of Operation *</label>
            <div style="display: flex; gap: 0.5rem;" id="daysOfWeekContainer">
              <button
                type="button"
                class="day-button"
                data-day="1"
                onclick="toggleDay(1)"
                style="flex: 1; padding: 0.75rem; background: var(--accent-color); border: 2px solid var(--accent-color); border-radius: 4px; color: white; font-weight: 600; cursor: pointer; transition: all 0.2s;"
              >
                M
              </button>
              <button
                type="button"
                class="day-button"
                data-day="2"
                onclick="toggleDay(2)"
                style="flex: 1; padding: 0.75rem; background: var(--accent-color); border: 2px solid var(--accent-color); border-radius: 4px; color: white; font-weight: 600; cursor: pointer; transition: all 0.2s;"
              >
                T
              </button>
              <button
                type="button"
                class="day-button"
                data-day="3"
                onclick="toggleDay(3)"
                style="flex: 1; padding: 0.75rem; background: var(--accent-color); border: 2px solid var(--accent-color); border-radius: 4px; color: white; font-weight: 600; cursor: pointer; transition: all 0.2s;"
              >
                W
              </button>
              <button
                type="button"
                class="day-button"
                data-day="4"
                onclick="toggleDay(4)"
                style="flex: 1; padding: 0.75rem; background: var(--accent-color); border: 2px solid var(--accent-color); border-radius: 4px; color: white; font-weight: 600; cursor: pointer; transition: all 0.2s;"
              >
                T
              </button>
              <button
                type="button"
                class="day-button"
                data-day="5"
                onclick="toggleDay(5)"
                style="flex: 1; padding: 0.75rem; background: var(--accent-color); border: 2px solid var(--accent-color); border-radius: 4px; color: white; font-weight: 600; cursor: pointer; transition: all 0.2s;"
              >
                F
              </button>
              <button
                type="button"
                class="day-button"
                data-day="6"
                onclick="toggleDay(6)"
                style="flex: 1; padding: 0.75rem; background: var(--accent-color); border: 2px solid var(--accent-color); border-radius: 4px; color: white; font-weight: 600; cursor: pointer; transition: all 0.2s;"
              >
                S
              </button>
              <button
                type="button"
                class="day-button"
                data-day="0"
                onclick="toggleDay(0)"
                style="flex: 1; padding: 0.75rem; background: var(--accent-color); border: 2px solid var(--accent-color); border-radius: 4px; color: white; font-weight: 600; cursor: pointer; transition: all 0.2s;"
              >
                S
              </button>
            </div>
          </div>
        </div>

        <!-- Return Sector Configuration -->
        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
          <div style="margin-bottom: 0.75rem;">
            <h3 style="color: var(--text-primary); font-weight: 600; font-size: 0.9rem; margin: 0;">RETURN SECTOR</h3>
            <p style="margin: 0.25rem 0 0 0; color: var(--text-muted); font-size: 0.75rem;">
              All routes include a return flight back to base
            </p>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
            <div>
              <label style="display: block; margin-bottom: 0.35rem; color: var(--text-secondary); font-weight: 600; font-size: 0.8rem;">Turnaround Time (minutes) *</label>
              <input
                type="number"
                id="turnaroundTime"
                value="45"
                min="15"
                step="5"
                onchange="onTurnaroundTimeChange()"
                style="width: 100%; padding: 0.5rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;"
              />
              <p id="turnaroundMinInfo" style="margin: 0.25rem 0 0 0; color: var(--text-muted); font-size: 0.7rem; display: none;">
                Minimum: <span id="minTurnaroundDisplay">--</span> mins (post-flight + pre-flight actions)
              </p>
            </div>

            <div>
              <label style="display: block; margin-bottom: 0.35rem; color: var(--text-secondary); font-weight: 600; font-size: 0.8rem;">Return Flight Number *</label>
              <div style="display: flex; gap: 0.25rem;">
                <input
                  type="text"
                  id="returnRoutePrefix"
                  value="--"
                  readonly
                  maxlength="2"
                  style="width: 3rem; padding: 0.5rem; background: var(--surface); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-muted); cursor: not-allowed; font-size: 0.9rem; text-align: center; font-weight: 600;"
                />
                <input
                  type="text"
                  id="returnRouteNumber"
                  placeholder="124"
                  maxlength="7"
                  oninput="validateRouteNumber('returnRouteNumber')"
                  style="flex: 1; padding: 0.5rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;"
                />
              </div>
            </div>

            <div>
              <label style="display: block; margin-bottom: 0.35rem; color: var(--text-secondary); font-weight: 600; font-size: 0.8rem;">Calculated Return Departure</label>
              <input
                type="text"
                id="calculatedReturnTime"
                readonly
                value="--:--"
                style="width: 100%; padding: 0.5rem; background: var(--surface); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-muted); cursor: not-allowed; font-size: 0.9rem;"
              />
            </div>
          </div>
        </div>

        <!-- Flight Timing and Route Map - Side by Side -->
        <div id="flightTimingMapContainer" style="display: none; margin-top: 1.5rem; gap: 1rem; grid-template-columns: 1fr 1fr; align-items: stretch;">
          <!-- Flight Timing Display (Left) -->
          <div id="flightTimingDisplay" style="min-width: 0; height: 100%;"></div>

          <!-- Route Map Preview (Right) -->
          <div id="routeMapSection" style="min-width: 0; display: flex; flex-direction: column;">
            <div style="margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center;">
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <h3 style="color: var(--text-primary); font-weight: 600; font-size: 0.85rem; margin: 0;">ROUTE MAP</h3>
                <button type="button" onclick="openExpandedRouteMap()" class="btn-expand-map" title="Expand map">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <polyline points="9 21 3 21 3 15"></polyline>
                    <line x1="21" y1="3" x2="14" y2="10"></line>
                    <line x1="3" y1="21" x2="10" y2="14"></line>
                  </svg>
                </button>
              </div>
              <button type="button" id="customAtcBtn" onclick="openCustomAtcModal()" class="btn-custom-atc">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.3rem;">
                  <path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                </svg>
                Set Custom ATC Route
              </button>
            </div>
            <div id="routePreviewMap" style="width: 100%; flex: 1; min-height: 200px; border-radius: 6px; border: 1px solid var(--border-color); background: #0d1117;"></div>
            <!-- Auto ATC route info -->
            <div id="autoAtcInfo" style="display: none; margin-top: 0.5rem; padding: 0.4rem 0.75rem; background: rgba(34, 211, 238, 0.06); border: 1px solid rgba(34, 211, 238, 0.2); border-radius: 4px; font-size: 0.72rem; color: var(--text-secondary);">
              <div style="display: flex; align-items: center; gap: 0.3rem;">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#22d3ee" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72"></path></svg>
                <span id="autoAtcInfoText" style="color: #22d3ee;">ATC Route</span>
              </div>
              <div id="autoAtcAvoidInfo" style="display: none; margin-top: 0.25rem; color: #f87171; font-size: 0.68rem;"></div>
            </div>
            <!-- Custom ATC route indicator -->
            <div id="customAtcIndicator" style="display: none; margin-top: 0.5rem; padding: 0.4rem 0.75rem; background: rgba(63, 185, 80, 0.08); border: 1px solid rgba(63, 185, 80, 0.3); border-radius: 4px; font-size: 0.75rem; color: #3fb950; align-items: center; gap: 0.4rem;">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
              <span id="customAtcIndicatorText">Custom ATC route set</span>
              <button onclick="clearCustomAtcRoute()" style="margin-left: auto; background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 0.7rem; text-decoration: underline;">Clear</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem; padding: 1rem;">
        <button onclick="backToStep1()" class="btn btn-secondary" style="padding: 0.6rem 1.5rem; font-size: 0.9rem;">← BACK</button>
        <button onclick="proceedToStep3()" class="btn btn-primary" style="padding: 0.6rem 1.5rem; font-size: 0.9rem;">NEXT → PRICING</button>
      </div>
    </div>
    </div>

    <!-- Step 3: Pricing Configuration (hidden initially) -->
    <div id="step3Container" style="display: none;">
      <!-- Back to Step 2 button -->
      <div style="margin-bottom: 1rem;">
        <button onclick="backToStep2()" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.85rem;">
          ← BACK TO SCHEDULE
        </button>
      </div>

      <!-- Route Summary Header -->
      <div class="ops-panel full-width" style="margin-bottom: 1rem;">
        <div class="panel-body" style="padding: 0.75rem;">
          <div id="step3RouteSummary" style="display: flex; justify-content: space-between; align-items: center;">
            <!-- Populated by JS -->
          </div>
        </div>
      </div>

      <!-- Pricing Configuration Panel -->
      <div class="ops-panel full-width" style="margin-bottom: 2rem;">
        <div class="panel-header" style="padding: 0.75rem 1rem;">
          <h2 style="font-size: 0.95rem; margin: 0;">PRICING & CARGO</h2>
        </div>
        <div class="panel-body" style="padding: 1rem;">
          <!-- Transport Type -->
          <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.35rem; color: var(--text-secondary); font-weight: 600; font-size: 0.8rem;">Transport Type *</label>
            <select
              id="transportType"
              onchange="updatePricingVisibility()"
              style="width: 100%; padding: 0.5rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;"
            >
              <option value="both">Transport both passengers and cargo</option>
              <option value="passengers_only">Transport only passengers (block all cargo capacity)</option>
              <option value="cargo_only">Transport only cargo (block all passenger capacity)</option>
            </select>
          </div>

          <!-- Passenger Pricing -->
          <div id="passengerPricingSection">
            <h4 style="color: var(--text-secondary); font-size: 0.8rem; margin: 0 0 0.75rem 0; font-weight: 600;">PASSENGER CLASS PRICING</h4>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1rem;">
              <div>
                <label style="display: block; margin-bottom: 0.35rem; color: var(--text-secondary); font-weight: 600; font-size: 0.8rem;">Economy Class ($) *</label>
                <input
                  type="number"
                  id="economyPrice"
                  placeholder="180"
                  min="1"
                  step="1"
                  onchange="autoCalculateBusinessFirst()"
                  style="width: 100%; padding: 0.5rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;"
                />
                <div style="display: flex; gap: 0.25rem; margin-top: 0.35rem;">
                  <button onclick="adjustPrice('economyPrice', -10)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-10%</button>
                  <button onclick="adjustPrice('economyPrice', -5)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-5%</button>
                  <button onclick="adjustPrice('economyPrice', 5)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+5%</button>
                  <button onclick="adjustPrice('economyPrice', 10)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+10%</button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 0.35rem; color: var(--text-secondary); font-weight: 600; font-size: 0.8rem;">Economy Plus ($)</label>
                <input
                  type="number"
                  id="economyPlusPrice"
                  placeholder="250"
                  min="0"
                  step="1"
                  style="width: 100%; padding: 0.5rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;"
                />
                <div style="display: flex; gap: 0.25rem; margin-top: 0.35rem;">
                  <button onclick="adjustPrice('economyPlusPrice', -10)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-10%</button>
                  <button onclick="adjustPrice('economyPlusPrice', -5)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-5%</button>
                  <button onclick="adjustPrice('economyPlusPrice', 5)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+5%</button>
                  <button onclick="adjustPrice('economyPlusPrice', 10)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+10%</button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 0.35rem; color: var(--text-secondary); font-weight: 600; font-size: 0.8rem;">Business Class ($) *</label>
                <input
                  type="number"
                  id="businessPrice"
                  placeholder="470"
                  min="1"
                  step="1"
                  style="width: 100%; padding: 0.5rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;"
                />
                <div style="display: flex; gap: 0.25rem; margin-top: 0.35rem;">
                  <button onclick="adjustPrice('businessPrice', -10)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-10%</button>
                  <button onclick="adjustPrice('businessPrice', -5)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-5%</button>
                  <button onclick="adjustPrice('businessPrice', 5)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+5%</button>
                  <button onclick="adjustPrice('businessPrice', 10)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+10%</button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 0.35rem; color: var(--text-secondary); font-weight: 600; font-size: 0.8rem;">First Class ($) *</label>
                <input
                  type="number"
                  id="firstPrice"
                  placeholder="830"
                  min="1"
                  step="1"
                  style="width: 100%; padding: 0.5rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;"
                />
                <div style="display: flex; gap: 0.25rem; margin-top: 0.35rem;">
                  <button onclick="adjustPrice('firstPrice', -10)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-10%</button>
                  <button onclick="adjustPrice('firstPrice', -5)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-5%</button>
                  <button onclick="adjustPrice('firstPrice', 5)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+5%</button>
                  <button onclick="adjustPrice('firstPrice', 10)" style="flex: 1; padding: 0.2rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 3px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+10%</button>
                </div>
              </div>
            </div>
            <div style="margin-bottom: 0.75rem;">
              <button onclick="adjustAllTicketPrices(-10)" style="padding: 0.3rem 0.6rem; font-size: 0.75rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 4px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s; margin-right: 0.35rem;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">All Classes -10%</button>
              <button onclick="adjustAllTicketPrices(-5)" style="padding: 0.3rem 0.6rem; font-size: 0.75rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 4px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s; margin-right: 0.35rem;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">All Classes -5%</button>
              <button onclick="adjustAllTicketPrices(5)" style="padding: 0.3rem 0.6rem; font-size: 0.75rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 4px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s; margin-right: 0.35rem;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">All Classes +5%</button>
              <button onclick="adjustAllTicketPrices(10)" style="padding: 0.3rem 0.6rem; font-size: 0.75rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 4px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">All Classes +10%</button>
            </div>
          </div>

          <!-- Cargo Pricing -->
          <div id="cargoPricingSection">
            <h4 style="color: var(--text-secondary); font-size: 0.8rem; margin: 1rem 0 0.5rem 0; font-weight: 600;">CARGO RATES (per ton)</h4>
            <!-- Core Cargo -->
            <div style="font-size: 0.65rem; color: var(--text-muted); font-weight: 600; margin-bottom: 0.3rem; text-transform: uppercase; letter-spacing: 0.5px;">Core</div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; margin-bottom: 0.6rem;">
              <div>
                <label style="display: block; margin-bottom: 0.25rem; color: var(--text-secondary); font-weight: 600; font-size: 0.7rem;">General ($/tn)</label>
                <input type="number" id="cargoRate_general" placeholder="80" min="0" step="10"
                  style="width: 100%; padding: 0.4rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem;"/>
                <div style="display: flex; gap: 0.2rem; margin-top: 0.25rem;">
                  <button onclick="adjustPrice('cargoRate_general', -5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-5%</button>
                  <button onclick="adjustPrice('cargoRate_general', 5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+5%</button>
                </div>
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.25rem; color: var(--text-secondary); font-weight: 600; font-size: 0.7rem;">Express ($/tn)</label>
                <input type="number" id="cargoRate_express" placeholder="150" min="0" step="10"
                  style="width: 100%; padding: 0.4rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem;"/>
                <div style="display: flex; gap: 0.2rem; margin-top: 0.25rem;">
                  <button onclick="adjustPrice('cargoRate_express', -5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-5%</button>
                  <button onclick="adjustPrice('cargoRate_express', 5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+5%</button>
                </div>
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.25rem; color: var(--text-secondary); font-weight: 600; font-size: 0.7rem;">Heavy/Dense ($/tn)</label>
                <input type="number" id="cargoRate_heavy" placeholder="200" min="0" step="10"
                  style="width: 100%; padding: 0.4rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem;"/>
                <div style="display: flex; gap: 0.2rem; margin-top: 0.25rem;">
                  <button onclick="adjustPrice('cargoRate_heavy', -5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-5%</button>
                  <button onclick="adjustPrice('cargoRate_heavy', 5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+5%</button>
                </div>
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.25rem; color: var(--text-secondary); font-weight: 600; font-size: 0.7rem;">Oversized ($/tn)</label>
                <input type="number" id="cargoRate_oversized" placeholder="350" min="0" step="10"
                  style="width: 100%; padding: 0.4rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem;"/>
                <div style="display: flex; gap: 0.2rem; margin-top: 0.25rem;">
                  <button onclick="adjustPrice('cargoRate_oversized', -5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-5%</button>
                  <button onclick="adjustPrice('cargoRate_oversized', 5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+5%</button>
                </div>
              </div>
            </div>
            <!-- Special Cargo -->
            <div style="font-size: 0.65rem; color: var(--text-muted); font-weight: 600; margin-bottom: 0.3rem; text-transform: uppercase; letter-spacing: 0.5px;">Special</div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; margin-bottom: 0.6rem;">
              <div>
                <label style="display: block; margin-bottom: 0.25rem; color: var(--text-secondary); font-weight: 600; font-size: 0.7rem;">Perishables ($/tn)</label>
                <input type="number" id="cargoRate_perishable" placeholder="180" min="0" step="10"
                  style="width: 100%; padding: 0.4rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem;"/>
                <div style="display: flex; gap: 0.2rem; margin-top: 0.25rem;">
                  <button onclick="adjustPrice('cargoRate_perishable', -5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-5%</button>
                  <button onclick="adjustPrice('cargoRate_perishable', 5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+5%</button>
                </div>
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.25rem; color: var(--text-secondary); font-weight: 600; font-size: 0.7rem;">DG ($/tn)</label>
                <input type="number" id="cargoRate_dangerous" placeholder="250" min="0" step="10"
                  style="width: 100%; padding: 0.4rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem;"/>
                <div style="display: flex; gap: 0.2rem; margin-top: 0.25rem;">
                  <button onclick="adjustPrice('cargoRate_dangerous', -5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-5%</button>
                  <button onclick="adjustPrice('cargoRate_dangerous', 5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+5%</button>
                </div>
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.25rem; color: var(--text-secondary); font-weight: 600; font-size: 0.7rem;">Live Animals ($/tn)</label>
                <input type="number" id="cargoRate_liveAnimal" placeholder="220" min="0" step="10"
                  style="width: 100%; padding: 0.4rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem;"/>
                <div style="display: flex; gap: 0.2rem; margin-top: 0.25rem;">
                  <button onclick="adjustPrice('cargoRate_liveAnimal', -5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-5%</button>
                  <button onclick="adjustPrice('cargoRate_liveAnimal', 5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+5%</button>
                </div>
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.25rem; color: var(--text-secondary); font-weight: 600; font-size: 0.7rem;">High-Value ($/tn)</label>
                <input type="number" id="cargoRate_highValue" placeholder="300" min="0" step="10"
                  style="width: 100%; padding: 0.4rem; background: var(--surface-elevated); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem;"/>
                <div style="display: flex; gap: 0.2rem; margin-top: 0.25rem;">
                  <button onclick="adjustPrice('cargoRate_highValue', -5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">-5%</button>
                  <button onclick="adjustPrice('cargoRate_highValue', 5)" style="flex:1;padding:0.15rem;font-size:0.6rem;background:var(--surface-elevated);border:1px solid var(--border-color);color:var(--text-muted);border-radius:3px;cursor:pointer;opacity:0.7;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">+5%</button>
                </div>
              </div>
            </div>
            <div>
              <button onclick="adjustAllCargoRates(-10)" style="padding: 0.25rem 0.5rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 4px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s; margin-right: 0.25rem;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">All Cargo -10%</button>
              <button onclick="adjustAllCargoRates(-5)" style="padding: 0.25rem 0.5rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 4px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s; margin-right: 0.25rem;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">All Cargo -5%</button>
              <button onclick="adjustAllCargoRates(5)" style="padding: 0.25rem 0.5rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 4px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s; margin-right: 0.25rem;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">All Cargo +5%</button>
              <button onclick="adjustAllCargoRates(10)" style="padding: 0.25rem 0.5rem; font-size: 0.7rem; background: var(--surface-elevated); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 4px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">All Cargo +10%</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
        <button onclick="backToStep2()" class="btn btn-secondary" style="padding: 0.6rem 1.5rem; font-size: 0.9rem;">← BACK</button>
        <button onclick="submitNewRoute()" class="btn btn-primary" style="padding: 0.6rem 1.5rem; font-size: 0.9rem;">CREATE ROUTE</button>
      </div>
    </div>
  </main>

  <!-- Custom ATC Route Modal -->
  <div id="customAtcModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9000; align-items: center; justify-content: center;">
    <div style="background: var(--surface, #0d1117); border: 1px solid var(--border-color, #30363d); border-radius: 8px; width: 90%; max-width: 580px; max-height: 85vh; display: flex; flex-direction: column; box-shadow: 0 8px 32px rgba(0,0,0,0.4);">
      <div style="display: flex; justify-content: space-between; align-items: flex-start; padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-color, #30363d);">
        <div>
          <h2 style="font-size: 1.1rem; font-weight: 700; margin: 0; color: var(--text-primary);">Custom ATC Route</h2>
          <span style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.15rem; display: block;">Paste a raw ATC route to override the auto-generated waypoints</span>
        </div>
        <button onclick="closeCustomAtcModal()" style="background: none; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer; padding: 0 0.25rem; line-height: 1;">&times;</button>
      </div>
      <div style="padding: 1.25rem 1.5rem; overflow-y: auto; flex: 1;">
        <!-- Input -->
        <div style="margin-bottom: 1rem;">
          <label style="display: block; font-size: 0.7rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">ATC Route String</label>
          <textarea
            id="atcRouteInput"
            rows="3"
            placeholder="e.g. KEA UN132 LAPSO GUDIS KAVOS EVORA LAKTO L560 SERMA L550 KARIK B411 DEESA Y415 TAMRO N318 HAYYA"
            style="width: 100%; padding: 0.6rem 0.75rem; background: var(--surface-elevated, #161b22); border: 1px solid var(--border-color, #30363d); border-radius: 6px; color: var(--text-primary); font-family: 'Courier New', monospace; font-size: 0.85rem; resize: vertical; box-sizing: border-box; line-height: 1.5;"
          ></textarea>
          <p style="font-size: 0.7rem; color: var(--text-muted); margin: 0.35rem 0 0 0;">Waypoints and airway identifiers separated by spaces. Airways (e.g. UN132, L560) will be noted but only fix coordinates are used.</p>
        </div>

        <!-- Resolve button -->
        <button type="button" id="resolveAtcBtn" onclick="resolveCustomAtcRoute()" style="padding: 0.45rem 1rem; background: var(--accent-color, #58a6ff); color: #000; border: none; border-radius: 4px; font-weight: 700; font-size: 0.8rem; cursor: pointer; text-transform: uppercase; letter-spacing: 0.3px;">
          Resolve Route
        </button>

        <!-- Results (hidden until resolved) -->
        <div id="atcResolveResults" style="display: none; margin-top: 1.25rem;">
          <!-- Summary -->
          <div style="display: flex; gap: 0.75rem; margin-bottom: 1rem;">
            <div id="atcResolvedCount" class="atc-stat-badge resolved">0 resolved</div>
            <div id="atcUnresolvedCount" class="atc-stat-badge unresolved" style="display: none;">0 unresolved</div>
            <div id="atcAirwayCount" class="atc-stat-badge airway">0 airways</div>
          </div>

          <!-- Unresolved warnings -->
          <div id="atcUnresolvedSection" style="display: none; margin-bottom: 1rem; padding: 0.6rem 0.75rem; background: rgba(227, 179, 65, 0.08); border: 1px solid rgba(227, 179, 65, 0.25); border-radius: 6px;">
            <div style="font-size: 0.75rem; font-weight: 600; color: #e3b341; margin-bottom: 0.3rem;">Unresolved Fixes</div>
            <div id="atcUnresolvedList" style="font-size: 0.8rem; color: #e3b341; font-family: 'Courier New', monospace;"></div>
            <p style="font-size: 0.7rem; color: var(--text-muted); margin: 0.3rem 0 0 0;">These fixes were not found in the navigation database and will be skipped.</p>
          </div>

          <!-- Airspace restriction warnings -->
          <div id="atcRestrictionSection" style="display: none; margin-bottom: 1rem; padding: 0.6rem 0.75rem; background: rgba(248, 81, 73, 0.08); border: 1px solid rgba(248, 81, 73, 0.3); border-radius: 6px;">
            <div style="font-size: 0.75rem; font-weight: 600; color: #f85149; margin-bottom: 0.3rem;">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="margin-right: 0.3rem; vertical-align: -1px;">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
              </svg>
              Route Crosses Restricted Airspace
            </div>
            <div id="atcRestrictionList" style="font-size: 0.8rem; color: #f85149;"></div>
            <p style="font-size: 0.7rem; color: var(--text-muted); margin: 0.3rem 0 0 0;">This route will be created as suspended if you proceed.</p>
          </div>

          <!-- Waypoint list -->
          <div style="margin-bottom: 0.5rem;">
            <label style="display: block; font-size: 0.7rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">Resolved Waypoints</label>
            <div id="atcWaypointList" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color, #30363d); border-radius: 6px; font-size: 0.8rem;"></div>
          </div>
        </div>
      </div>
      <div style="padding: 1rem 1.5rem; border-top: 1px solid var(--border-color, #30363d); display: flex; gap: 0.75rem; justify-content: flex-end;">
        <button onclick="closeCustomAtcModal()" style="padding: 0.5rem 1rem; background: var(--surface-elevated, #161b22); border: 1px solid var(--border-color, #30363d); color: var(--text-primary); border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 0.8rem; text-transform: uppercase;">Cancel</button>
        <button id="applyAtcBtn" onclick="applyCustomAtcRoute()" disabled style="padding: 0.5rem 1rem; background: #3fb950; border: 1px solid #3fb950; color: #000; border-radius: 4px; cursor: pointer; font-weight: 700; font-size: 0.8rem; text-transform: uppercase; opacity: 0.5;">Apply Route</button>
      </div>
    </div>
  </div>

  <!-- Expanded Route Map Modal -->
  <div id="expandedMapModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:2000; align-items:center; justify-content:center;">
    <div style="width:92%; height:88%; background:var(--surface, #0d1117); border:1px solid var(--border-color, #30363d); border-radius:8px; display:flex; flex-direction:column; overflow:hidden;">
      <div style="display:flex; justify-content:space-between; align-items:center; padding:0.75rem 1rem; border-bottom:1px solid var(--border-color, #30363d);">
        <h3 id="expandedMapTitle" style="margin:0; font-size:0.85rem; font-weight:600; color:var(--text-primary);">ROUTE MAP</h3>
        <button onclick="closeExpandedRouteMap()" style="background:none; border:none; color:var(--text-muted); font-size:1.5rem; cursor:pointer; padding:0 0.25rem; line-height:1;">&times;</button>
      </div>
      <div id="expandedMapContainer" style="flex:1; min-height:0;"></div>
    </div>
  </div>
</div>
