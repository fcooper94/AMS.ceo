<!-- TITLE: World Selection - AMS.ceo -->
<!-- SUBTITLE: Operations Center -->
<!-- SCRIPTS: /js/world-selection.js -->

<div class="dashboard-container">
  <main class="main-content">
    <div class="page-header">
      <h1>WORLD SELECTION</h1>
      <p class="subtitle">SELECT AN OPERATIONAL ENVIRONMENT</p>
    </div>

    <!-- Mode Selector -->
    <div id="modeSelector">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
        <button onclick="selectMode('sp')" class="mode-select-btn">
          <svg width="44" height="44" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="7" r="4"></circle>
            <path d="M5.5 21a6.5 6.5 0 0 1 13 0"></path>
          </svg>
          <span class="mode-select-title">SINGLE PLAYER</span>
          <span class="mode-select-desc">Build your airline empire at your own pace with AI competition</span>
        </button>
        <button onclick="selectMode('mp')" class="mode-select-btn">
          <svg width="44" height="44" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          <span class="mode-select-title">MULTIPLAYER</span>
          <span class="mode-select-desc">Compete against other players in shared worlds</span>
        </button>
      </div>
      <div id="globalStatsBar" class="global-stats-bar" style="display: none;">
        <div class="global-stat">
          <span class="global-stat-value" id="statTotalAirlines">-</span>
          <span class="global-stat-label">Airlines</span>
        </div>
        <div class="global-stat">
          <span class="global-stat-value" id="statTotalAircraft">-</span>
          <span class="global-stat-label">Aircraft</span>
        </div>
        <div class="global-stat">
          <span class="global-stat-value" id="statTotalRoutes">-</span>
          <span class="global-stat-label">Routes</span>
        </div>
        <div class="global-stat">
          <span class="global-stat-value" id="statCredits">-</span>
          <span class="global-stat-label">Your Credits</span>
        </div>
      </div>
    </div>

    <!-- World Lists (hidden until mode selected) -->
    <div id="worldListView" style="display: none;">
      <div style="margin-bottom: 1rem;">
        <button onclick="backToModeSelector()" style="
          background: none;
          border: 1px solid var(--border-color);
          color: var(--text-secondary);
          font-size: 0.8rem;
          padding: 0.4rem 0.8rem;
          border-radius: 4px;
          cursor: pointer;
          display: inline-flex;
          align-items: center;
          gap: 0.4rem;
        ">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
          Back
        </button>
      </div>

      <div id="singlePlayerSection" class="worlds-section" style="display: none;">
        <h2 class="section-title">SINGLE PLAYER</h2>
        <div id="singlePlayerList" class="worlds-grid"></div>
      </div>

      <div id="multiplayerSection" class="worlds-section" style="display: none;">
        <h2 class="section-title">MULTIPLAYER</h2>
        <div id="multiplayerList" class="worlds-grid"></div>
      </div>
    </div>
  </main>
</div>

<!-- Create Single-Player World Modal -->
<div id="createSPModal" class="modal" style="display: none;">
  <div class="modal-content join-modal-content">
    <div class="modal-header">
      <h2>CREATE SINGLE-PLAYER WORLD</h2>
      <button class="modal-close" onclick="closeCreateSPModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="join-modal-grid">
        <!-- Left Column: World & Airline Settings -->
        <div class="join-modal-col">
          <div class="join-modal-codes">
            <div class="form-group">
              <label for="spEra">ERA / START YEAR *</label>
              <select id="spEra" onchange="updateSPPreview(); clearSPSelectedAirport();">
                <option value="1950">1950s - Propeller Era</option>
                <option value="1960">1960s - Early Jet Era</option>
                <option value="1970">1970s - Widebody Era</option>
                <option value="1980">1980s - Deregulation Era</option>
                <option value="1990">1990s - Modern Era</option>
                <option value="2000">2000s - Next-Gen Era</option>
                <option value="2010" selected>2010s - Contemporary Era</option>
                <option value="2020">2020s - Current Era</option>
              </select>
            </div>
            <div class="form-group">
              <label for="spSpeed">GAME SPEED</label>
              <select id="spSpeed">
                <option value="30">30x (Slow)</option>
                <option value="60" selected>60x (Normal)</option>
                <option value="120">120x (Fast)</option>
                <option value="240">240x (Very Fast)</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>DIFFICULTY *</label>
            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-top: 0.25rem;">
              <label class="difficulty-option">
                <input type="radio" name="spDifficulty" value="easy" onchange="updateSPPreview()">
                <div>
                  <div style="font-weight: 600; color: #22c55e;">EASY</div>
                  <div style="font-size: 0.75rem; color: var(--text-secondary);">Fewer, less aggressive AI competitors. Higher starting funds.</div>
                </div>
              </label>
              <label class="difficulty-option">
                <input type="radio" name="spDifficulty" value="medium" checked onchange="updateSPPreview()">
                <div>
                  <div style="font-weight: 600; color: #f59e0b;">MEDIUM</div>
                  <div style="font-size: 0.75rem; color: var(--text-secondary);">Balanced competition. AI airlines match market rates.</div>
                </div>
              </label>
              <label class="difficulty-option">
                <input type="radio" name="spDifficulty" value="hard" onchange="updateSPPreview()">
                <div>
                  <div style="font-weight: 600; color: #ef4444;">HARD</div>
                  <div style="font-size: 0.75rem; color: var(--text-secondary);">Many aggressive AI competitors. They will undercut your prices.</div>
                </div>
              </label>
            </div>
          </div>

          <div style="border-top: 1px solid var(--border-color); padding-top: 0.75rem; margin-top: 0.5rem;">
            <div class="form-group">
              <label for="spAirlineName">AIRLINE NAME *</label>
              <input type="text" id="spAirlineName" maxlength="50" placeholder="e.g., Transatlantic Airways">
            </div>
            <div class="join-modal-codes">
              <div class="form-group">
                <label for="spAirlineCode">ICAO CODE * (3 letters)</label>
                <input type="text" id="spAirlineCode" maxlength="3" placeholder="e.g., TRA" style="text-transform: uppercase;">
              </div>
              <div class="form-group">
                <label for="spIataCode">IATA CODE * (2 letters)</label>
                <input type="text" id="spIataCode" maxlength="2" placeholder="e.g., TR" style="text-transform: uppercase;">
              </div>
            </div>
            <div style="font-size: 0.7rem; color: var(--text-muted); margin-top: -0.5rem;">
              IATA code is your flight number prefix (e.g., BA for BA123)
            </div>
          </div>

          <div class="form-info" style="margin-top: 0.75rem;">
            <p id="spStartingCapital">Starting Capital: Loading...</p>
            <p>Starting Reputation: 50/100</p>
            <p id="spAICountPreview" style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--border-color); color: var(--accent-color); font-weight: 600;">
              AI Competitors: Select airport to calculate
            </p>
            <p id="spCreditCost" style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--border-color);">
              <span style="color: var(--warning-color); font-weight: 600;">Creation Cost: 10 Credits</span>
              <span id="spUserCredits" style="margin-left: 0.5rem; color: var(--text-secondary);">(Loading...)</span>
            </p>
            <p style="font-size: 0.8rem; color: var(--text-secondary);">+ 1 credit per game week (first 4 weeks free)</p>
          </div>
        </div>

        <!-- Right Column: Base Airport -->
        <div class="join-modal-col">
          <div class="form-group" style="margin-bottom: 0;">
            <label for="spBaseAirport">BASE AIRPORT *</label>
            <div style="position: relative;">
              <input
                type="text"
                id="spAirportSearch"
                placeholder="Search by name, city, or code..."
                autocomplete="off"
                style="margin-bottom: 0.25rem;"
              >
              <div style="text-align: center; margin-bottom: 0.4rem;">
                <a href="#" onclick="openAirportBrowser('sp'); return false;" style="
                  font-size: 0.8rem;
                  color: var(--primary-color);
                  text-decoration: none;
                  cursor: pointer;
                " onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">
                  Browse all airports
                </a>
              </div>
              <div id="spAirportResults" style="
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                max-height: 300px;
                overflow-y: auto;
                background: var(--surface-elevated);
                border: 1px solid var(--border-color);
                border-radius: 4px;
                z-index: 1000;
                margin-top: 0.25rem;
              "></div>
              <div id="spSelectedAirportDisplay" style="
                padding: 0.6rem;
                background: var(--surface-elevated);
                border: 1px solid var(--border-color);
                border-radius: 4px;
                margin-top: 0.5rem;
                display: none;
              ">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 0.75rem;">
                  <div style="flex: 1; min-width: 0;">
                    <div style="font-weight: 600; color: var(--text-primary); font-size: 0.95rem;" id="spSelectedAirportName"></div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);" id="spSelectedAirportLocation"></div>
                    <div style="margin-top: 0.5rem;">
                      <div style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 0.2rem;">Traffic Demand</div>
                      <div id="spSelectedAirportTraffic"></div>
                      <div id="spSelectedAirportPassengers" style="margin-top: 0.2rem; font-size: 0.7rem; color: var(--text-secondary);"></div>
                    </div>
                    <div style="margin-top: 0.4rem;">
                      <div style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 0.2rem;">Spare Capacity</div>
                      <div id="spSelectedAirportInfrastructure"></div>
                    </div>
                  </div>
                  <button type="button" onclick="clearSPSelectedAirport()" style="
                    padding: 0.25rem 0.5rem;
                    background: var(--warning-color);
                    border: none;
                    border-radius: 3px;
                    color: white;
                    cursor: pointer;
                    font-size: 0.75rem;
                    flex-shrink: 0;
                    height: fit-content;
                  ">Change</button>
                </div>
              </div>
            </div>
            <input type="hidden" id="spBaseAirport">
            <input type="hidden" id="spBaseAirportType">
          </div>
        </div>
      </div>

      <div id="spCreateError" class="error-message" style="display: none;"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeCreateSPModal()">Cancel</button>
      <button class="btn btn-primary" onclick="createSinglePlayerWorld()">Create World</button>
    </div>
  </div>
</div>

<!-- Join World Modal -->
<div id="joinModal" class="modal" style="display: none;">
  <div class="modal-content join-modal-content">
    <div class="modal-header">
      <h2>JOIN WORLD — <span id="selectedWorldName" style="color: var(--accent-color);"></span></h2>
      <button class="modal-close" onclick="closeJoinModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="join-modal-grid">
        <!-- Left Column: Airline Details -->
        <div class="join-modal-col">
          <div class="form-group">
            <label for="airlineName">AIRLINE NAME *</label>
            <input type="text" id="airlineName" maxlength="50" placeholder="e.g., Transatlantic Airways">
          </div>

          <div class="join-modal-codes">
            <div class="form-group">
              <label for="airlineCode">ICAO CODE * (3 letters)</label>
              <input type="text" id="airlineCode" maxlength="3" placeholder="e.g., TRA" style="text-transform: uppercase;">
            </div>
            <div class="form-group">
              <label for="iataCode">IATA CODE * (2 letters)</label>
              <input type="text" id="iataCode" maxlength="2" placeholder="e.g., TR" style="text-transform: uppercase;">
            </div>
          </div>
          <div style="font-size: 0.7rem; color: var(--text-muted); margin-top: -0.5rem; margin-bottom: 0.75rem;">
            IATA code is your flight number prefix (e.g., BA for BA123)
          </div>

          <div class="form-info">
            <p id="startingCapital">Starting Capital: Loading...</p>
            <p>Starting Reputation: 50/100</p>
            <p id="creditCost" style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--border-color);">
              <span style="color: var(--warning-color); font-weight: 600;">Join Cost: 10 Credits</span>
              <span id="userCredits" style="margin-left: 0.5rem; color: var(--text-secondary);">(Loading...)</span>
            </p>
            <p id="weeklyMembershipCost" style="font-size: 0.8rem; color: var(--text-secondary);">+ 1 credit per game week to maintain membership</p>
          </div>
        </div>

        <!-- Right Column: Base Airport -->
        <div class="join-modal-col">
          <div class="form-group" style="margin-bottom: 0;">
            <label for="baseAirport">BASE AIRPORT *</label>
            <div style="position: relative;">
              <input
                type="text"
                id="airportSearch"
                placeholder="Search by name, city, or code..."
                autocomplete="off"
                style="margin-bottom: 0.25rem;"
              >
              <div style="text-align: center; margin-bottom: 0.4rem;">
                <a href="#" onclick="openAirportBrowser(); return false;" style="
                  font-size: 0.8rem;
                  color: var(--primary-color);
                  text-decoration: none;
                  cursor: pointer;
                " onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">
                  Browse all airports
                </a>
              </div>
              <div id="airportResults" style="
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                max-height: 300px;
                overflow-y: auto;
                background: var(--surface-elevated);
                border: 1px solid var(--border-color);
                border-radius: 4px;
                z-index: 1000;
                margin-top: 0.25rem;
              "></div>
              <div id="selectedAirportDisplay" style="
                padding: 0.6rem;
                background: var(--surface-elevated);
                border: 1px solid var(--border-color);
                border-radius: 4px;
                margin-top: 0.5rem;
                display: none;
              ">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 0.75rem;">
                  <div style="flex: 1; min-width: 0;">
                    <div style="font-weight: 600; color: var(--text-primary); font-size: 0.95rem;" id="selectedAirportName"></div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);" id="selectedAirportLocation"></div>

                    <!-- Traffic Demand Scale -->
                    <div style="margin-top: 0.5rem;">
                      <div style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 0.2rem;">Traffic Demand</div>
                      <div id="selectedAirportTraffic"></div>
                      <div id="selectedAirportPassengers" style="margin-top: 0.2rem; font-size: 0.7rem; color: var(--text-secondary);"></div>
                    </div>

                    <!-- Spare Capacity Scale -->
                    <div style="margin-top: 0.4rem;">
                      <div style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 0.2rem;">Spare Capacity</div>
                      <div id="selectedAirportInfrastructure"></div>
                    </div>
                  </div>
                  <button type="button" onclick="clearSelectedAirport()" style="
                    padding: 0.25rem 0.5rem;
                    background: var(--warning-color);
                    border: none;
                    border-radius: 3px;
                    color: white;
                    cursor: pointer;
                    font-size: 0.75rem;
                    flex-shrink: 0;
                    height: fit-content;
                  ">Change</button>
                </div>
              </div>
            </div>
            <input type="hidden" id="baseAirport">
          </div>
        </div>
      </div>

      <div id="joinError" class="error-message" style="display: none;"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeJoinModal()">Cancel</button>
      <button class="btn btn-primary" onclick="confirmJoin()">Join World</button>
    </div>
  </div>
</div>

<!-- Bankruptcy Confirmation Modal -->
<div id="bankruptcyModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2>DECLARE BANKRUPTCY</h2>
      <button class="modal-close" onclick="closeBankruptcyModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>WORLD</label>
        <div id="bankruptcyWorldName" class="form-value"></div>
      </div>
      <div class="form-info" style="background: rgba(217, 119, 6, 0.15); border-color: var(--warning-color);">
        <p style="color: var(--warning-color); font-weight: 600;">WARNING: This action cannot be undone.</p>
        <p>Declaring bankruptcy will:</p>
        <p>• Remove your airline from this world</p>
        <p>• Delete all your assets and progress</p>
        <p>• Free up your airline code for others</p>
        <p style="margin-top: 1rem;">You can rejoin this world later with a fresh start.</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeBankruptcyModal()">Cancel</button>
      <button class="btn btn-primary" style="background: var(--warning-color); border-color: var(--warning-color);" onclick="confirmBankruptcy()">Declare Bankruptcy</button>
    </div>
  </div>
</div>

<!-- End SP World Confirmation Modal -->
<div id="endWorldModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2>END WORLD</h2>
      <button class="modal-close" onclick="closeEndWorldModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>WORLD</label>
        <div id="endWorldName" class="form-value"></div>
      </div>
      <div class="form-info" style="background: rgba(248, 81, 73, 0.15); border-color: #f85149;">
        <p style="color: #f85149; font-weight: 600;">WARNING: This action cannot be undone.</p>
        <p>Ending this world will:</p>
        <p>&bull; Permanently stop all game time progression</p>
        <p>&bull; Freeze all AI airline operations</p>
        <p>&bull; Mark the world as completed</p>
        <p style="margin-top: 1rem; color: var(--text-secondary);">You can still view the world after ending it.</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeEndWorldModal()">Cancel</button>
      <button class="btn btn-primary" style="background: #f85149; border-color: #f85149;" onclick="confirmEndWorld()">End World</button>
    </div>
  </div>
</div>

<!-- Rejoin SP World Modal -->
<div id="rejoinWorldModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2>START FRESH AIRLINE</h2>
      <button class="modal-close" onclick="closeRejoinModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>WORLD</label>
        <div id="rejoinWorldName" class="form-value"></div>
      </div>
      <div class="form-info" style="background: rgba(34, 197, 94, 0.1); border-color: rgba(34, 197, 94, 0.3);">
        <p style="color: #22c55e; font-weight: 600;">Create a new airline in this existing world.</p>
        <p>You'll start with fresh capital. AI airlines and the world economy will continue as they are.</p>
      </div>
      <div class="form-group">
        <label>AIRLINE NAME</label>
        <input type="text" id="rejoinAirlineName" placeholder="e.g. Pacific Airways" maxlength="50">
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
        <div class="form-group">
          <label>ICAO CODE (3-4 letters)</label>
          <input type="text" id="rejoinAirlineCode" placeholder="e.g. PAC" maxlength="4" style="text-transform: uppercase;">
        </div>
        <div class="form-group">
          <label>IATA CODE (2 letters)</label>
          <input type="text" id="rejoinIataCode" placeholder="e.g. PA" maxlength="2" style="text-transform: uppercase;">
        </div>
      </div>
      <div class="form-group">
        <label>BASE AIRPORT</label>
        <input type="text" id="rejoinAirportSearch" placeholder="Search by name, ICAO, or city..." autocomplete="off">
        <div id="rejoinAirportResults" style="display: none; max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 4px; margin-top: 0.25rem;"></div>
        <div id="rejoinSelectedAirport" style="display: none; padding: 0.5rem; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 4px; margin-top: 0.25rem;"></div>
      </div>
      <div id="rejoinError" class="error-message" style="display: none;"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeRejoinModal()">Cancel</button>
      <button class="btn btn-primary" onclick="confirmRejoin()">Create Airline</button>
    </div>
  </div>
</div>

<!-- Airport Browser Modal -->
<div id="airportBrowserModal" class="modal" style="display: none;">
  <div class="modal-content" style="max-width: 900px; max-height: 90vh;">
    <div class="modal-header">
      <h2>BROWSE AIRPORTS</h2>
      <button class="modal-close" onclick="closeAirportBrowser()">&times;</button>
    </div>
    <div class="modal-body" style="padding: 0;">
      <!-- Filters -->
      <div style="padding: 1rem; border-bottom: 1px solid var(--border-color); background: var(--surface);">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          <div>
            <label style="display: block; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.25rem;">REGION</label>
            <select id="regionFilter" onchange="filterAirportBrowser()" style="
              width: 100%;
              padding: 0.5rem;
              background: var(--surface-elevated);
              border: 1px solid var(--border-color);
              border-radius: 4px;
              color: var(--text-primary);
              font-size: 0.9rem;
            ">
              <option value="">All Regions</option>
            </select>
          </div>
          <div>
            <label style="display: block; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.25rem;">COUNTRY</label>
            <select id="countryFilter" onchange="filterAirportBrowser()" style="
              width: 100%;
              padding: 0.5rem;
              background: var(--surface-elevated);
              border: 1px solid var(--border-color);
              border-radius: 4px;
              color: var(--text-primary);
              font-size: 0.9rem;
            ">
              <option value="">All Countries</option>
            </select>
          </div>
        </div>
        <div style="margin-top: 0.75rem; font-size: 0.85rem; color: var(--text-secondary);">
          Showing <span id="airportCount">0</span> airports • Sorted by traffic demand
        </div>
      </div>

      <!-- Airport List -->
      <div id="airportBrowserList" style="
        max-height: 500px;
        overflow-y: auto;
        padding: 1rem;
      ">
        <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
          Loading airports...
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeAirportBrowser()">Close</button>
    </div>
  </div>
</div>
